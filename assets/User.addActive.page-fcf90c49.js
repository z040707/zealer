import{r as o,H,o as l,c as te,V as le,W as ne,m as W,w as G,P as k,j as p,R as ae}from"./index-ce7fb889.js";import{B as oe}from"./use-resize-effect-1bab2614.js";import{u as se,I as ie}from"./index-b01732f5.js";import{I as re,b as A,d as ce,s as ue}from"./styled-components.browser.esm-b4eee38b.js";import{u as Q}from"./input-52f9904a.js";import{S as de}from"./space-64d7cbdc.js";import{G as me,I as pe,a as fe,s as he}from"./ZComment-d3d2a23d.js";import{L as M}from"./index-f9dd01d7.js";import{P as ge}from"./popup-2dc1f97f.js";import{r as V}from"./ellipsis-5b3a1378.js";import"./safe-area-c2e7b740.js";import"./rubberband-9373f189.js";import"./convert-px-964282f9.js";import"./infinite-scroll-22c3637e.js";import"./use-inner-visible-00b2e519.js";function ve(i){return o.createElement("svg",Object.assign({width:"1em",height:"1em",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},i,{style:Object.assign({verticalAlign:"-0.125em"},i.style),className:["antd-mobile-icon",i.className].filter(Boolean).join(" ")}),o.createElement("g",{id:"AddOutline-AddOutline",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},o.createElement("g",{id:"AddOutline-add"},o.createElement("rect",{id:"AddOutline-矩形",fill:"#FFFFFF",opacity:0,x:0,y:0,width:48,height:48}),o.createElement("path",{d:"M25.1,6.5 C25.3209139,6.5 25.5,6.6790861 25.5,6.9 L25.5,22.5 L41.1,22.5 C41.3209139,22.5 41.5,22.6790861 41.5,22.9 L41.5,25.1 C41.5,25.3209139 41.3209139,25.5 41.1,25.5 L25.5,25.5 L25.5,41.1 C25.5,41.3209139 25.3209139,41.5 25.1,41.5 L22.9,41.5 C22.6790861,41.5 22.5,41.3209139 22.5,41.1 L22.5,25.5 L6.9,25.5 C6.6790861,25.5 6.5,25.3209139 6.5,25.1 L6.5,22.9 C6.5,22.6790861 6.6790861,22.5 6.9,22.5 L22.5,22.5 L22.5,6.9 C22.5,6.6790861 22.6790861,6.5 22.9,6.5 L25.1,6.5 Z",id:"AddOutline-路径",fill:"currentColor",fillRule:"nonzero"}))))}function we(i){if(i==null||i==="")return 0;const u=i.trim();return u.endsWith("px")?parseFloat(u):u.endsWith("rem")?parseFloat(u)*parseFloat(window.getComputedStyle(document.documentElement).fontSize):u.endsWith("vw")?parseFloat(u)*window.innerWidth/100:0}const F="adm-image-uploader",xe=i=>{const{locale:u}=H(),{url:e,file:a,deletable:d,deleteIcon:f,onDelete:h,imageFit:v}=i,w=o.useMemo(()=>e||(a?URL.createObjectURL(a):""),[e,a]);o.useEffect(()=>()=>{a&&URL.revokeObjectURL(w)},[w,a]);function C(){return i.status==="pending"&&l.createElement("div",{className:`${F}-cell-mask`},l.createElement("span",{className:`${F}-cell-loading`},l.createElement(le,{color:"white"}),l.createElement("span",{className:`${F}-cell-mask-message`},u.ImageUploader.uploading)))}function y(){return d&&l.createElement("span",{className:`${F}-cell-delete`,onClick:h},f)}return l.createElement("div",{className:te(`${F}-cell`,i.status==="fail"&&`${F}-cell-fail`)},l.createElement(re,{className:`${F}-cell-image`,src:w,fit:v,onClick:i.onClick}),C(),y())},T=xe,b="adm-image-uploader",Ce={disableUpload:!1,deletable:!0,deleteIcon:l.createElement(ne,{className:`${b}-cell-delete-icon`}),showUpload:!0,multiple:!1,maxCount:0,defaultValue:[],accept:"image/*",preview:!0,showFailed:!0,imageFit:"cover"},be=i=>{const{locale:u}=H(),e=W(Ce,i),{columns:a}=e,[d,f]=Q(e),[h,v]=o.useState([]),w=o.useRef(null),C=se(w),y=o.useRef(null),[N,S]=o.useState(80);A(()=>{const t=y.current;if(a&&C&&t){const n=C.width,g=we(window.getComputedStyle(t).getPropertyValue("height"));S((n-g*(a-1))/a)}},[C==null?void 0:C.width]);const $={"--cell-size":N+"px"};A(()=>{v(t=>t.filter(n=>n.url===void 0?!0:!d.some(g=>g.url===n.url)))},[d]),A(()=>{var t;(t=e.onUploadQueueChange)===null||t===void 0||t.call(e,h.map(n=>({id:n.id,status:n.status})))},[h]);const s=o.useRef(0),{maxCount:r,onPreview:x,renderItem:O}=e;function P(t,n){return k(this,void 0,void 0,function*(){const{beforeUpload:g}=e;let m=t;return m=yield g==null?void 0:g(t,n),m})}function B(t){return e.showFailed?t:t.filter(n=>n.status!=="fail")}function q(t){var n;return k(this,void 0,void 0,function*(){t.persist();const{files:g}=t.target;if(!g)return;let m=[].slice.call(g);if(t.target.value="",e.beforeUpload){const c=m.map(R=>P(R,m));yield Promise.all(c).then(R=>{m=R.filter(Boolean)})}if(m.length===0)return;if(r>0){const c=d.length+m.length-r;c>0&&(m=m.slice(0,m.length-c),(n=e.onCountExceed)===null||n===void 0||n.call(e,c))}const U=m.map(c=>({id:s.current++,status:"pending",file:c}));v(c=>[...B(c),...U]);const j=[];yield Promise.all(U.map((c,R)=>k(this,void 0,void 0,function*(){try{const L=yield e.upload(c.file);j[R]=L,v(_=>_.map(E=>E.id===c.id?Object.assign(Object.assign({},E),{status:"success",url:L.url}):E))}catch(L){throw v(_=>_.map(E=>E.id===c.id?Object.assign(Object.assign({},E),{status:"fail"}):E)),L}}))).catch(c=>console.error(c)),f(c=>c.concat(j))})}const z=o.useRef(null);function J(t){z.current=ie.Multi.show({images:d.map(n=>n.url),defaultIndex:t,onClose:()=>{z.current=null}})}ce(()=>{var t;(t=z.current)===null||t===void 0||t.close()});const K=B(h),Y=e.showUpload&&(r===0||d.length+K.length<r),ee=()=>d.map((t,n)=>{var g,m;const U=l.createElement(T,{key:(g=t.key)!==null&&g!==void 0?g:n,url:(m=t.thumbnailUrl)!==null&&m!==void 0?m:t.url,deletable:e.deletable,deleteIcon:e.deleteIcon,imageFit:e.imageFit,onClick:()=>{e.preview&&J(n),x&&x(n,t)},onDelete:()=>k(void 0,void 0,void 0,function*(){var j;(yield(j=e.onDelete)===null||j===void 0?void 0:j.call(e,t))!==!1&&f(d.filter((R,L)=>L!==n))})});return O?O(U,t,d):U}),D=l.createElement(l.Fragment,null,ee(),h.map(t=>!e.showFailed&&t.status==="fail"?null:l.createElement(T,{key:t.id,file:t.file,deletable:t.status!=="pending",deleteIcon:e.deleteIcon,status:t.status,imageFit:e.imageFit,onDelete:()=>{v(h.filter(n=>n.id!==t.id))}})),l.createElement("div",{className:`${b}-upload-button-wrap`,style:Y?void 0:{display:"none"}},e.children||l.createElement("span",{className:`${b}-cell ${b}-upload-button`,role:"button","aria-label":u.ImageUploader.upload},l.createElement("span",{className:`${b}-upload-button-icon`},l.createElement(ve,null))),!e.disableUpload&&l.createElement("input",{capture:e.capture,accept:e.accept,multiple:e.multiple,type:"file",className:`${b}-input`,onChange:q,"aria-hidden":!0})));return G(e,l.createElement("div",{className:b,ref:w},a?l.createElement(me,{className:`${b}-grid`,columns:a,style:$},l.createElement("div",{className:`${b}-gap-measure`,ref:y}),D.props.children):l.createElement(de,{className:`${b}-space`,wrap:!0,block:!0},D.props.children)))};const I="adm-text-area",X={rows:2,showCount:!1,autoSize:!1,defaultValue:""},Z=o.forwardRef((i,u)=>{const e=W(X,i),{autoSize:a,showCount:d,maxLength:f}=e,[h,v]=Q(Object.assign(Object.assign({},e),{value:e.value===null?"":e.value}));e.value;const w=o.useRef(null),C=o.useRef("auto"),y=o.useRef(null);o.useImperativeHandle(u,()=>({clear:()=>{v("")},focus:()=>{var s;(s=w.current)===null||s===void 0||s.focus()},blur:()=>{var s;(s=w.current)===null||s===void 0||s.blur()},get nativeElement(){return w.current}})),A(()=>{if(!a)return;const s=w.current,r=y.current;if(!s||(s.style.height=C.current,!r))return;let x=r.scrollHeight;if(typeof a=="object"){const O=window.getComputedStyle(s),P=parseFloat(O.lineHeight);a.minRows&&(x=Math.max(x,a.minRows*P)),a.maxRows&&(x=Math.min(x,a.maxRows*P))}C.current=`${x}px`,s.style.height=`${x}px`},[h,a]);const N=o.useRef(!1);let S;const $=V(h).length;return typeof d=="function"?S=d($,f):d&&(S=l.createElement("div",{className:`${I}-count`},f===void 0?$:$+"/"+f)),G(e,l.createElement("div",{className:I},l.createElement("textarea",{ref:w,className:`${I}-element`,rows:e.rows,value:h,placeholder:e.placeholder,onChange:s=>{let r=s.target.value;f&&!N.current&&(r=V(r).slice(0,f).join("")),v(r)},id:e.id,onCompositionStart:s=>{var r;N.current=!0,(r=e.onCompositionStart)===null||r===void 0||r.call(e,s)},onCompositionEnd:s=>{var r;if(N.current=!1,f){const x=s.target.value;v(V(x).slice(0,f).join(""))}(r=e.onCompositionEnd)===null||r===void 0||r.call(e,s)},autoComplete:e.autoComplete,autoFocus:e.autoFocus,disabled:e.disabled,readOnly:e.readOnly,name:e.name,onFocus:e.onFocus,onBlur:e.onBlur,onClick:e.onClick}),S,a&&l.createElement("textarea",{ref:y,className:`${I}-element ${I}-element-hidden`,value:h,rows:e.rows,"aria-hidden":!0,readOnly:!0})))});Z.defaultProps=X;const ye=ue.div`
  .title {
    margin-top: 8px;
    height: 48px;
    line-height: 48px;
    .adm-list-item {
      background: rgba(120, 120, 128, 0.06);
    }
  }
  .content {
    padding: 16px;
    .ImageUploader {
      padding: 16px 0;
    }
  }
`,_e=()=>{const[i,u]=o.useState(!1),[e,a]=o.useState([]),[d,f]=o.useState("选择话题");async function h(v){return await he(3e3),{url:URL.createObjectURL(v)}}return p.jsxs(ye,{children:[p.jsx("div",{className:"title",children:p.jsx(M,{children:p.jsx(M.Item,{prefix:p.jsx("div",{children:p.jsx(pe,{type:"well",color:"#ffd60a"})}),title:p.jsx("div",{style:{fontSize:"14px",color:"#1e1e27"},children:d}),extra:p.jsx("div",{style:{fontSize:"12px",color:"#acacb0"},children:"选择话题获取更多"}),onClick:()=>{u(!0)}})})}),p.jsxs("div",{className:"content",children:[p.jsx(Z,{rows:5,showCount:!0,maxLength:200,placeholder:"写下此刻的想法...",style:{"--placeholder-color":"#808080","--color":"#b2b2b5"}}),p.jsx(be,{value:e,onChange:a,upload:h,className:"ImageUploader"}),p.jsx(oe,{block:!0,onClick:()=>{},color:"warning",children:"发表"})]}),p.jsxs(ge,{visible:i,showCloseButton:!0,onMaskClick:()=>{u(!1)},onClose:()=>{u(!1)},bodyStyle:{height:"88vh"},children:[p.jsx(ae,{style:{height:"44px",lineHeight:"44px",fontSize:"16px",color:"#00000a"},children:"选择话题"}),p.jsx("div",{className:"content",style:{height:"94%"},children:p.jsx(fe,{joinBtn:!0,setTopic:f})})]})]})};export{_e as default};
